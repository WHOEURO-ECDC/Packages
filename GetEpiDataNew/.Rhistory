GetEpiData()
res <- content(GET(url = 'https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services/EURO_COVID19_Running_v3/FeatureServer/0/query?',
query = list(
where = "1=1",
returnGeometry = "false",
returnIdsOnly = TRUE,
f = "geojson"),
as = "text",
encoding = "UTF-8"))
id_field <- res[[1]]#res$objectIdFieldName # if fails use this res[[1]]
n_records <- list()
n_records$max_id <- unlist(res[[2]]) %>% max()
n_records$count <- length(res[[2]])
# Do until all records are exported
# Retrieve recrords from the feature service and merge into a single data frame
id <- 0
data <- tibble()
while (id<n_records$max_id) {
records <- content(GET(url = 'https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services/EURO_COVID19_Running_v3/FeatureServer',
query = list(
where = paste(w,"and",id_field,">=",id) ,
returnGeometry = rg,
outFields = of,
returnIdsOnly = FALSE,
f = "geojson")),
as = "text", encoding = "UTF-8") %>%
fromJSON(., flatten = TRUE)  %>% .$features %>% as_tibble() %>%
rename_all(list(~ sub(".*?[[:punct:]]", "",.)))
id_new <- records %>% summarise(max(!!as.name(id_field))) %>% pull
if(nrow(records)==0 | id_new == id ) {
#if no records are returned, break loop
break
} else{
data <- rbind(data,records)
id <- id_new +1
}
}
url <- parse_url("https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services/EURO_COVID19_Running_v3/FeatureServer")
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url <- parse_url("https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services/EURO_COVID19_Running_v3/FeatureServer")
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url$query <- list(where = "1 = 1",
outFields = "*",
returnGeometry = "true",
f = "geojson")
request <- build_url(url)
Florida_Railroads <- st_read(request)
library(sf)
Florida_Railroads <- st_read(request)
url <- parse_url("https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services")
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url$query <- list(where = "1 = 1",
outFields = "*",
returnGeometry = "true",
f = "geojson")
request <- build_url(url)
Florida_Railroads <- st_read(request)
View(Florida_Railroads)
url <- parse_url("https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services")
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url$query <- list(where = "1 = 1",
outFields = "*",
returnGeometry = "false",
f = "geojson")
request <- build_url(url)
Florida_Railroads <- st_read(request)
View(Florida_Railroads)
library(httr)
library(sf)
library(tmap)
url <- parse_url("https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services")
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url$query <- list(where = "1 = 1",
outFields = "*",
returnGeometry = "false",
f = "geojson")
request <- build_url(url)
EpiData <- st_read(request)
request <- build_url(url)
request
EpiData <- st_read(request)
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url
get_data<-function(orgID='5T5nSi527N4F7luB',service_name,layerid=0,whereclause='1=1',returngeo='false',fieldlist='*',f='pjson',UIDfield='ObjectId'){
# returns json data from an esri web feature service
#
# parameters:
#   orgID (string): ArcGIS Online Organization ID (default is WHO = '5T5nSi527N4F7luB')
#   service_name (string): name of the feature service
#   layerid (int): id of the layer (default = 0)
#   whereclause (string): where condition. Where clause field(s) don't have to be in the fieldlist. Sample syntax: 'Population > 100000' (default = "1=1")
#   returngeo (string): boolean to return geometry; recommended to keep false unless needed
#   fieldlist (string): list of output fields. Sample syntax: 'CountryName, Population' (default = '*')
#   f (string): output format (default = 'pjson')
#   UIDfield (string): field name which contains the unique identifier (default = 'OBJECTID')
#
# returns:
# data (tibble): feature service converted to a tibble
out <- tryCatch(
{
# Cycle requests using OID and keeplooping parameters until all records have been acquired
# and merge into a single data frame
OID <- -1
keeplooping = 1
urlbase = paste('https://services.arcgis.com', orgID, 'arcgis/rest/services',sep="/")
data <- tibble()
while (keeplooping > 0) {
print (paste("Pulling records with", UIDfield, "greater than", OID, sep=" "))
records <- content(GET(url = paste(urlbase,service_name,"FeatureServer",layerid,"query?",sep="/"),
query = list(
where = paste(whereclause,"and",UIDfield,">",OID),
returnGeometry = returngeo,
outFields = fieldlist,
returnIdsOnly = 'false',
f = f,
orderByFields = UIDfield)),
as = "text", encoding = "UTF-8") %>%
fromJSON(., flatten = TRUE)  %>% .$features %>% as_tibble() %>%
rename_all(list(~ sub(".*?[[:punct:]]", "",.)))
if(nrow(records) > 0) {
OID <- records %>% summarise(max(!!as.name(UIDfield))) %>% pull
}
data <- rbind(data,records)
if(nrow(records) < 2000) {
#if < 2000 records are returned, bail out
keeplooping = 0
}
}
#convert esri data to dttm
data <- data %>%  mutate_if(~ (is.double(.) && min(., na.rm = TRUE) > 1e12 && min(., na.rm = TRUE) %% 1000 ==0) , list(~as.POSIXct(./1000,origin="1970-01-01",tz="GMT")))
return(data)
},
error = function(cond) {
message(paste0("Request failed. Please review the paramaters."))
#message(request$status_code)
message(cond)
})
}
service_name <- "EURO_COVID19_ADM0_Cases"
#service_name <- 'EURO_COVID19_Running_v3'
returnedData <- get_data(service_name=service_name)
View(returnedData)
library(httr)
library(stringr)
library(jsonlite)
library(dplyr)
get_data<-function(orgID='5T5nSi527N4F7luB',service_name,layerid=0,whereclause='1=1',returngeo='false',fieldlist='*',f='pjson',UIDfield='ObjectId'){
# returns json data from an esri web feature service
#
# parameters:
#   orgID (string): ArcGIS Online Organization ID (default is WHO = '5T5nSi527N4F7luB')
#   service_name (string): name of the feature service
#   layerid (int): id of the layer (default = 0)
#   whereclause (string): where condition. Where clause field(s) don't have to be in the fieldlist. Sample syntax: 'Population > 100000' (default = "1=1")
#   returngeo (string): boolean to return geometry; recommended to keep false unless needed
#   fieldlist (string): list of output fields. Sample syntax: 'CountryName, Population' (default = '*')
#   f (string): output format (default = 'pjson')
#   UIDfield (string): field name which contains the unique identifier (default = 'OBJECTID')
#
# returns:
# data (tibble): feature service converted to a tibble
out <- tryCatch(
{
# Cycle requests using OID and keeplooping parameters until all records have been acquired
# and merge into a single data frame
OID <- -1
keeplooping = 1
urlbase = paste('https://services.arcgis.com', orgID, 'arcgis/rest/services',sep="/")
data <- tibble()
while (keeplooping > 0) {
print (paste("Pulling records with", UIDfield, "greater than", OID, sep=" "))
records <- content(GET(url = paste(urlbase,service_name,"FeatureServer",layerid,"query?",sep="/"),
query = list(
where = paste(whereclause,"and",UIDfield,">",OID),
returnGeometry = returngeo,
outFields = fieldlist,
returnIdsOnly = 'false',
f = f,
orderByFields = UIDfield)),
as = "text", encoding = "UTF-8") %>%
fromJSON(., flatten = TRUE)  %>% .$features %>% as_tibble() %>%
rename_all(list(~ sub(".*?[[:punct:]]", "",.)))
if(nrow(records) > 0) {
OID <- records %>% summarise(max(!!as.name(UIDfield))) %>% pull
}
data <- rbind(data,records)
if(nrow(records) < 2000) {
#if < 2000 records are returned, bail out
keeplooping = 0
}
}
#convert esri data to dttm
data <- data %>%  mutate_if(~ (is.double(.) && min(., na.rm = TRUE) > 1e12 && min(., na.rm = TRUE) %% 1000 ==0) , list(~as.POSIXct(./1000,origin="1970-01-01",tz="GMT")))
return(data)
},
error = function(cond) {
message(paste0("Request failed. Please review the paramaters."))
#message(request$status_code)
message(cond)
})
}
#service_name <- "EURO_COVID19_ADM0_Cases"
service_name <- 'EURO_COVID19_Running_v3'
returnedData <- get_data(service_name=service_name)
View(returnedData)
library(httr)
library(sf)
library(tmap)
url <- parse_url("https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services")
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url$query <- list(where = paste(w,"and",id_field,">=",id),
outFields = "*",
returnGeometry = "false",
f = "geojson")
request <- build_url(url)
EpiData <- st_read(request)
EpiData
class(EpiData)
EpiData <- as.dataframe(st_read(request))
EpiData <- as.data.frame(st_read(request))
EpiData<-st_as_sf(EpiData)
EpiData <- st_read(request)
url <- parse_url("https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services")
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url$query <- list(where = paste(w,"and",id_field,">=",id),
outFields = "*",
returnGeometry = "false",
f = "geojson")
request <- build_url(url)
EpiData <- st_read(request)
View(EpiData)
url <- parse_url("https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services")
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url$query <- list(where = paste(w,"and",id_field,">=",id),
outFields = "*",
returnGeometry = "false",
f = "geojson")
request <- build_url(url)
EpiData <- st_read(request)
View(EpiData)
url <- parse_url("https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services")
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url$query <- list(where = '1=1',
outFields = "*",
returnGeometry = "false",
f = "geojson")
request <- build_url(url)
EpiData <- st_read(request)
EpiData<-st_as_sf(EpiData)
EpiData
class(EpiData)
EpiData <- st_read(request,quiet=TRUE)
EpiData <- as.data.frame(st_read(request))
View(EpiData)
write.csv(EpiData,'EpiData.csv')
EpiData <- st_read(request) %>% st_drop_geometry()
class(EpiData)
library(httr)
library(sf)
url <- parse_url("https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services")
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url$query <- list(where = paste(w,"and",id_field,">=",id),
outFields = "*",
returnGeometry = "false",
f = "geojson")
request <- build_url(url)
EpiData <- st_read(request) %>% st_drop_geometry()
library(httr)
library(sf)
url <- parse_url("https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services")
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url$query <- list(where = '1=1',
outFields = "*",
returnGeometry = "false",
f = "geojson")
request <- build_url(url)
EpiData <- st_read(request) %>% st_drop_geometry()
url <- parse_url("https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services")
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url$query <- list(where = '1=1',
outFields = "*",
returnGeometry = "false",
f = "geojson")
request <- build_url(url)
EpiData <- st_read(request) %>% st_drop_geometry()
url <- parse_url("https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services")
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url$query <- list(where = '1=1',
outFields = "*",
returnGeometry = "false",
f = "geojson")
request <- build_url(url)
EpiData <- st_read(request) %>% st_drop_geometry()
library(roxygen2)
setwd('C:/Users/romanc/Documents/GitHub/Packages')
create('GetEpiData_NEW')
create('GetEpiDataNew')
setwd('./GetEpiDataNew')
document()
rm(list = c("GetEpiData"))
document()
detach("package:GetEpiData", unload = TRUE)
setwd('..')
install('GetEpiDataNew')
GetEpiData()
test<-GetEpiData()
View(test)
shiny::runApp('~/GitHub/HIM/Shiny_TransitionIndicators')
MainDataset<-GetEpiData()
View(MainDataset)
MainDataset<-MainDataset %>% select(WHO_Code=WHO_CODE,ADM0NAME,DateReport1=DateReport,epiWeek,NewCases,NewDeaths,TotalCases,TotalDeaths) %>%
mutate(DateReport1=as.Date(parse_date_time(DateReport1,c("dmy", "ymd","mdy"))),
ADM0NAME=str_to_title(ADM0NAME),
NewCases=ifelse(NewCases<0,0,NewCases),
NewDeaths=ifelse(NewDeaths<0,0,NewDeaths))
MainDataset<-GetEpiData()
# MainDataset<-read.csv('qry_COVID_running_cases_country_date.CSV')
MainDataset<-MainDataset %>% select(WHO_Code=WHO_CODE,ADM0NAME,DateReport1=DateReport,epiWeek,NewCases,NewDeaths,TotalCases,TotalDeaths) %>%
mutate(DateReport1=as.Date(parse_date_time(DateReport1,c("dmy", "ymd","mdy"))))
View(MainDataset)
MainDataset<-GetEpiData()
GetEpiData<-function(){
url <- parse_url("https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services")
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url$query <- list(where = '1=1',
outFields = "*",
returnGeometry = "false",
f = "geojson")
request <- build_url(url)
EpiData <- st_read(request) %>% st_drop_geometry()
}
url <- parse_url("https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services")
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url$query <- list(where = '1=1',
outFields = "*",
returnGeometry = "false",
f = "geojson")
request <- build_url(url)
EpiData <- st_read(request) %>% st_drop_geometry()
View(EpiData)
View(EpiData)
EpiData <- st_read(request)
?st_read
View(EpiData)
url <- parse_url("https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services")
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url$query <- list(where = '1=1',
outFields = "*",
returnGeometry = "false",
f = "geojson")
request <- build_url(url)
EpiData <- st_read(request) %>% st_drop_geometry() %>%
mutate(as.POSIXct(DateReport, origin="1970-01-01"))
EpiData <- st_read(request) %>% st_drop_geometry() %>%
mutate(DateReport=as.POSIXct(DateReport, origin="1970-01-01"))
url <- parse_url("https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services")
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url$query <- list(where = '1=1',
outFields = "*",
returnGeometry = "false",
f = "geojson")
request <- build_url(url)
EpiData <- st_read(request) %>% st_drop_geometry()
max(EpiData$DateReport)
request <- build_url(url)
request
date<-1607212800000
url <- parse_url("https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services")
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url$query <- list(where = '1=1',
outFields = "*",
returnGeometry = "false",
f = "geojson")
request <- build_url(url)
EpiData <- st_read(request) %>% st_drop_geometry() #%>%
mutate(DateReport=as.POSIXct(DateReport/1000, origin="1970-01-01"))
url <- parse_url("https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services")
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url$query <- list(where = '1=1',
outFields = "*",
returnGeometry = "false",
f = "geojson")
request <- build_url(url)
EpiData <- st_read(request) %>% st_drop_geometry() %>%
mutate(DateReport=as.POSIXct(DateReport/1000, origin="1970-01-01"))
GetPopulation()
url <- parse_url("https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services")
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url$query <- list(where = '1=1',
outFields = "*",
returnGeometry = "false",
f = "geojson")
request <- build_url(url)
EpiData <- st_read(request) %>% st_drop_geometry() %>%
mutate(DateReport=format(as.POSIXct(DateReport/1000, origin="1970-01-01"),'%Y-%M-%D'))
EpiData <- st_read(request) %>% st_drop_geometry() %>%
mutate(DateReport=as.POSIXct(DateReport/1000, origin="1970-01-01"))
EpiData <- st_read(request) %>% st_drop_geometry() %>%
mutate(DateReport=format(as.POSIXct(DateReport/1000, origin="1970-01-01"),'%y-%m-%d')
EpiData <- st_read(request) %>% st_drop_geometry() %>%
mutate(DateReport=format(as.POSIXct(DateReport/1000, origin="1970-01-01"),'%y-%m-%d'))
EpiData <- st_read(request) %>% st_drop_geometry() %>%
mutate(DateReport=format(as.POSIXct(DateReport/1000, origin="1970-01-01"),'%Y-%m-%d'))
View(EpiData)
EpiData <- st_read(request) %>% st_drop_geometry() %>%
mutate(DateReport=as.Date(format(as.POSIXct(DateReport/1000, origin="1970-01-01"),'%Y-%m-%d')))
getwd()
setwd('/GetEpiDataNew')
setwd('./GetEpiDataNew')
getwd()
document()
rm(list = c("GetEpiData"))
document()
detach("package:GetPopulation", unload = TRUE)
setwd('..')
getwd()
install('GetEpiDataNew')
library('GetEpiDataNew')
GetEpiData()
MainDataset<-GetEpiData()
MainDataset<-MainDataset %>% select(WHO_Code=WHO_CODE,ADM0NAME,DateReport1=DateReport,epiWeek,NewCases,NewDeaths,TotalCases,TotalDeaths) %>%
mutate(DateReport1=as.Date(parse_date_time(DateReport1,c("dmy", "ymd","mdy")))),
ADM0NAME=str_to_title(ADM0NAME),
NewCases=ifelse(NewCases<0,0,NewCases),
NewDeaths=ifelse(NewDeaths<0,0,NewDeaths)) %>%
left_join(PopulationDataset,by="ADM0NAME") %>%
mutate(DailyRateCases=NewCases/Population*100000,
CumulativeRateCases=TotalCases/Population*100000,
DailyRateDeaths=NewDeaths/Population*1000000,
CumulativeRateDeaths=TotalDeaths/Population*1000000)
PopulationDataset<-read.csv(paste0('https://arcgis.com/sharing/rest/content/items/187ccf0236294e1fa3cdf300e0596e96/data?token=',token),encoding='UTF-8') %>%
select(ADM0NAME=ADM0_NAME,Population)
user <- "EURO_DevOps"
pwd <- "@utomat!0N47"
url <- "https://www.arcgis.com/sharing/rest/generateToken"
params <- list(username = user,
password = pwd,
referer = "http://www.arcgis.com",
f = "json")
r <- POST(url, body = params)
token <- content(r)$token
PopulationDataset<-read.csv(paste0('https://arcgis.com/sharing/rest/content/items/187ccf0236294e1fa3cdf300e0596e96/data?token=',token),encoding='UTF-8') %>%
select(ADM0NAME=ADM0_NAME,Population)
MainDataset<-MainDataset %>% select(WHO_Code=WHO_CODE,ADM0NAME,DateReport1=DateReport,epiWeek,NewCases,NewDeaths,TotalCases,TotalDeaths) %>%
mutate(DateReport1=as.Date(parse_date_time(DateReport1,c("dmy", "ymd","mdy")))),
ADM0NAME=str_to_title(ADM0NAME),
NewCases=ifelse(NewCases<0,0,NewCases),
NewDeaths=ifelse(NewDeaths<0,0,NewDeaths)) %>%
left_join(PopulationDataset,by="ADM0NAME") %>%
mutate(DailyRateCases=NewCases/Population*100000,
CumulativeRateCases=TotalCases/Population*100000,
DailyRateDeaths=NewDeaths/Population*1000000,
CumulativeRateDeaths=TotalDeaths/Population*1000000)
MainDataset<-MainDataset %>% select(WHO_Code=WHO_CODE,ADM0NAME,DateReport1=DateReport,epiWeek,NewCases,NewDeaths,TotalCases,TotalDeaths) %>%
mutate(DateReport1=as.Date(parse_date_time(DateReport1,c("dmy", "ymd","mdy"))),
ADM0NAME=str_to_title(ADM0NAME),
NewCases=ifelse(NewCases<0,0,NewCases),
NewDeaths=ifelse(NewDeaths<0,0,NewDeaths))
MainDataset<-GetEpiData()
# MainDataset<-read.csv('qry_COVID_running_cases_country_date.CSV')
MainDataset<-MainDataset %>% select(WHO_Code=WHO_CODE,ADM0NAME,DateReport1=DateReport,epiWeek,NewCases,NewDeaths,TotalCases,TotalDeaths)
test<-GetEpiData()
View(test)
GetEpiDataNew<-function(){
url <- parse_url("https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services")
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url$query <- list(where = '1=1',
outFields = "*",
returnGeometry = "false",
f = "geojson")
request <- build_url(url)
EpiData <- st_read(request) %>% st_drop_geometry() %>%
mutate(DateReport=as.Date(format(as.POSIXct(DateReport/1000, origin="1970-01-01"),'%Y-%m-%d')))
}
test<-GetEpiDataNew()
View(test)
getwd()
setwd('./GetEpiDataNew')
document()
rm(list = c("GetEpiDataNew"))
document()
setwd('..')
install('GetEpiDataNew')
MainDataset<-GetEpiDataNew()
# MainDataset<-read.csv('qry_COVID_running_cases_country_date.CSV')
MainDataset<-MainDataset %>% select(WHO_Code=WHO_CODE,ADM0NAME,DateReport1=DateReport,epiWeek,NewCases,NewDeaths,TotalCases,TotalDeaths) %>%
mutate(DateReport1=as.Date(parse_date_time(DateReport1,c("dmy", "ymd","mdy"))),
ADM0NAME=str_to_title(ADM0NAME),
NewCases=ifelse(NewCases<0,0,NewCases),
NewDeaths=ifelse(NewDeaths<0,0,NewDeaths)) %>%
left_join(PopulationDataset,by="ADM0NAME")
MainDataset<-GetEpiDataNew()
test<-GetEpiDataNew()
View(test)
GetEpiDataNew<-function(){
url <- parse_url("https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services")
url$path <- paste(url$path, "EURO_COVID19_Running_v3/FeatureServer/0/query", sep = "/")
url$query <- list(where = '1=1',
outFields = "*",
returnGeometry = "false",
f = "geojson")
request <- build_url(url)
EpiData <- st_read(request) %>% st_drop_geometry() %>%
mutate(DateReport=as.Date(format(as.POSIXct(DateReport/1000, origin="1970-01-01"),'%Y-%m-%d')))
}
test<-GetEpiDataNew()
getwd()
setwd('./GetEpiDataNew')
document()
rm(list = c("GetEpiDataNew"))
document()
test<-GetEpiDataNew()
