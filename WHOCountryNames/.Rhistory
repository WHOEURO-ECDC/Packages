who_names<-read.csv(here::here('data','ref_Country.csv'))
who_names<-read.csv(here::here('data','ref_Country.csv')) %>% select(ADM0NAME) %>%
mutate(ADM0NAME=str_to_title(ADM0NAME))
library('dplyr')
library(dplyr)
install.packages('rlang')
library(RtChart)
RtChart('Belgium')
WHOCountryNames <- function(dataset,countryfield) {
who_names<-read.csv(here::here('data','ref_Country.csv')) %>% select(ADM0NAME) %>%
mutate(ADM0NAME=str_to_title(ADM0NAME))
countryfield <- enquo(countryfield)
NewDataset<-dataset %>%
mutate(!!countryfield:=str_to_title(!!countryfield)) %>%
mutate(!!countryfield:=case_when(!!countryfield %in% who_names$ADM0NAME ~ !!countryfield,
!!countryfield=='Czechia' ~ 'Czech Republic',
!!countryfield=='Moldova' ~ 'Republic Of Moldova',
!!countryfield=='Russia' ~ 'Russian Federation',
!!countryfield=='Russian Fed.' ~ 'Russian Federation',
!!countryfield=='UK' ~ 'United Kingdom'))
return(NewDataset)
}
library(rlang)
library('rlang')
install.packages(rlang)
install.packages('rlang')
library(rlang)
library('rlang')
library(usethis)
WHOCountryNames <- function(dataset,countryfield) {
who_names<-WHO_ref %>% select(ADM0NAME) %>%
mutate(ADM0NAME=str_to_title(ADM0NAME))
countryfield <- enquo(countryfield)
NewDataset<-dataset %>%
mutate(!!countryfield:=str_to_title(!!countryfield)) %>%
mutate(!!countryfield:=case_when(!!countryfield %in% who_names$ADM0NAME ~ !!countryfield,
!!countryfield=='Czechia' ~ 'Czech Republic',
!!countryfield=='Moldova' ~ 'Republic Of Moldova',
!!countryfield=='Russia' ~ 'Russian Federation',
!!countryfield=='Russian Fed.' ~ 'Russian Federation',
!!countryfield=='Russian Fed' ~ 'Russian Federation',
!!countryfield=='UK' ~ 'United Kingdom',
!!countryfield=='Bosnia & Herzegovina' ~ 'Bosnia And Herzegovina',
!!countryfield=='United Kingdom Of Great Britain And Northern Ireland' ~ 'United Kingdom',
!!countryfield=='Kosovo[1]' ~ 'Kosovo',
!!countryfield=='Kosovo(1)' ~ 'Kosovo',
!!countryfield=='Kosovo*' ~ 'Kosovo',
!!countryfield=='Kyrgystan' ~ 'Kyrgyzstan',
!!countryfield=='United Kingdom' ~ 'The United Kingdom',
!!countryfield=='Turkey' ~ 'Türkiye'))
return(NewDataset)
}
library("shiny")
library("DT")
library("dplyr")
library("httr")
library("jsonlite")
library("stringr")
library("readxl")
library("lubridate")
library("WHOCountryNames")
library("GetPopulationNew")
library("tidyr")
library('GetEpiDataNew')
library('sf')
#library('SummaryTable')
#setwd('C:/Users/romanc/Desktop/R/Scripts/ShinyApps/Table')
#### BEGIN PRODUCE Summary Table
Dataset_Epiforecast_ <- read.csv("https://raw.githubusercontent.com/epiforecasts/covid-rt-estimates/master/national/cases/summary/rt.csv") %>%
filter(type=='estimate')
Rt_country<-function(ctr){
Dataset_Epiforecast_Country<-Dataset_Epiforecast_ %>% filter(country==ctr)
MaxDate<-max(Dataset_Epiforecast_Country$date)
DataMaxDate<-Dataset_Epiforecast_Country %>% filter(date==MaxDate)
return(DataMaxDate)
}
GlobalRtDataset<-data.frame()
for (ctr in unique(Dataset_Epiforecast_$country)){
GlobalRtDataset_<-Rt_country(ctr)
GlobalRtDataset<-bind_rows(GlobalRtDataset,GlobalRtDataset_)
}
#MaxDateRt<-max(Dataset_Epiforecast_$date)
#paste0("Import R values for date: ", MaxDateRt )
Dataset_Epiforecast <- GlobalRtDataset %>%
select(ADM0NAME="country", Last_Update='date',RO='median',CI_low='lower_90', CI_up='upper_90') %>%
mutate(Trend=if_else(CI_low<1 & CI_up<1,"Decreasing",if_else(CI_low<=1 & CI_up>=1,"Stable","Increasing"))) %>%
mutate(RO=round(RO,digits=2)) %>%
mutate(CI_low=round(CI_low,digits=2)) %>%
mutate(CI_up=round(CI_up,digits=2)) %>%
select(ADM0NAME,RO,CI_low,CI_up,Last_Update,Trend)
#local extract of population from ref_Country.csv
# Dataset_GlobalPopulation<-read.csv("ref_Country.csv") %>%
#  select(ADM0NAME,UNPOP2019) %>% mutate(ADM0NAME=str_to_title(ADM0NAME))
Dataset_GlobalPopulation<-GetPopulationNew() %>% select(ADM0NAME=ADM0_NAME,UNPOP2019=Population) %>%
WHOCountryNames(ADM0NAME)
View(Dataset_GlobalPopulation)
Dataset_Epiforecast_ <- read.csv("https://raw.githubusercontent.com/epiforecasts/covid-rt-estimates/master/national/cases/summary/rt.csv") %>%
filter(type=='estimate')
Rt_country<-function(ctr){
Dataset_Epiforecast_Country<-Dataset_Epiforecast_ %>% filter(country==ctr)
MaxDate<-max(Dataset_Epiforecast_Country$date)
DataMaxDate<-Dataset_Epiforecast_Country %>% filter(date==MaxDate)
return(DataMaxDate)
}
GlobalRtDataset<-data.frame()
for (ctr in unique(Dataset_Epiforecast_$country)){
GlobalRtDataset_<-Rt_country(ctr)
GlobalRtDataset<-bind_rows(GlobalRtDataset,GlobalRtDataset_)
}
Dataset_Epiforecast <- GlobalRtDataset %>%
select(ADM0NAME="country", Last_Update='date',RO='median',CI_low='lower_90', CI_up='upper_90') %>%
mutate(Trend=if_else(CI_low<1 & CI_up<1,"Decreasing",if_else(CI_low<=1 & CI_up>=1,"Stable","Increasing"))) %>%
mutate(RO=round(RO,digits=2)) %>%
mutate(CI_low=round(CI_low,digits=2)) %>%
mutate(CI_up=round(CI_up,digits=2)) %>%
select(ADM0NAME,RO,CI_low,CI_up,Last_Update,Trend)
Dataset_GlobalPopulation<-GetPopulationNew() %>% select(ADM0NAME=ADM0_NAME,UNPOP2019=Population)
View(Dataset_GlobalPopulation)
Dataset_GlobalPopulation<-GetPopulationNew() %>% select(ADM0NAME=ADM0_NAME,UNPOP2019=Population) %>%
WHOCountryNames(ADM0NAME)
View(Dataset_GlobalPopulation)
who_names<-WHO_ref %>% select(ADM0NAME) %>%
mutate(ADM0NAME=str_to_title(ADM0NAME))
View(who_names)
#' WHO_Names function
#' This function will transform any country name as per WHO convention
#' @param dataset - dataset containing country names to convert to WHO reference
#' @param countryfield - name of the field containing country names - Don't use quotes!
#' @export
WHOCountryNames <- function(dataset,countryfield) {
who_names<-WHO_ref %>% select(ADM0NAME) %>%
mutate(ADM0NAME=str_to_title(ADM0NAME))
countryfield <- enquo(countryfield)
NewDataset<-dataset %>%
mutate(!!countryfield:=str_to_title(!!countryfield)) %>%
mutate(!!countryfield:=case_when(#!!countryfield %in% who_names$ADM0NAME ~ !!countryfield,
!!countryfield=='Czechia' ~ 'Czech Republic',
!!countryfield=='Moldova' ~ 'Republic Of Moldova',
!!countryfield=='Russia' ~ 'Russian Federation',
!!countryfield=='Russian Fed.' ~ 'Russian Federation',
!!countryfield=='Russian Fed' ~ 'Russian Federation',
!!countryfield=='UK' ~ 'United Kingdom',
!!countryfield=='Bosnia & Herzegovina' ~ 'Bosnia And Herzegovina',
!!countryfield=='United Kingdom Of Great Britain And Northern Ireland' ~ 'United Kingdom',
!!countryfield=='Kosovo[1]' ~ 'Kosovo',
!!countryfield=='Kosovo(1)' ~ 'Kosovo',
!!countryfield=='Kosovo*' ~ 'Kosovo',
!!countryfield=='Kyrgystan' ~ 'Kyrgyzstan',
!!countryfield=='United Kingdom' ~ 'The United Kingdom',
!!countryfield=='Turkey' ~ 'Türkiye'))
return(NewDataset)
}
Dataset_GlobalPopulation<-GetPopulationNew() %>% select(ADM0NAME=ADM0_NAME,UNPOP2019=Population) %>%
WHOCountryNames(ADM0NAME)
View(Dataset_GlobalPopulation)
WHO_ref<-read.csv('ref_Country.csv')
usethis::use_data(WHO_ref, overwrite = TRUE)
who_names<-WHO_ref %>% select(ADM0NAME) %>%
mutate(ADM0NAME=str_to_title(ADM0NAME))
View(who_names)
who_names<-WHO_ref %>% select(ADM0NAME) %>%
mutate(ADM0NAME=str_to_title(ADM0NAME))
library(dplyr)
who_names<-WHO_ref %>% select(ADM0NAME) %>%
mutate(ADM0NAME=str_to_title(ADM0NAME))
setwd('C:/Users/celin/Desktop/Github/EURO-ECDC/Packages/WHOCountryNames')
document()
library(roxygen2)
library(devtools)
document()
document()
install_github('WHOEURO-ECDC/WHOCountryNames')
install_github('WHOEURO-ECDC/Packages/WHOCountryNames')
